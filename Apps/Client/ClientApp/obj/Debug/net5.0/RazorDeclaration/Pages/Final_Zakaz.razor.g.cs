// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace ClientApp.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using ClientApp;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using ClientApp.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using MudBlazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using ClientApp.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\User\Downloads\ClientApp\ClientApp\_Imports.razor"
using ClientApp.Pages;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/final_zakaz")]
    public partial class Final_Zakaz : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 52 "C:\Users\User\Downloads\ClientApp\ClientApp\Pages\Final_Zakaz.razor"
       
    ClientSOAP clientSOAP;
    bool butt = true;
    double price_;
    //SetCena cena = new();
    protected override void OnInitialized()
    {
        price_ = Convert.ToDouble(Math.Round((Configurator_page.select_mat.price_mater * spr.weight_ref * 1.08), 2));
    }
     
    RefProd spr = Conf_Osobenn.selectedIzd;
    double selectedVal; //выбранный размер

    CreateOrder createOrder = new();


    private void Price_shet(double selVal)
    {
        this.selectedVal = selVal;
        butt = false;
        price_ = Convert.ToDouble(Math.Round((Configurator_page.select_mat.price_mater * (spr.weight_ref + selectedVal * 0.15) * 1.08), 2));
    }
    private async void SetIzdelie()
    {
        //izdel.IdIzdspr = spr.IdIzdspr;
        //izdel.DateShtampa = null;
        //izdel.IdProb = 1;
        //izdel.Razmer = selectedVal;
        //izdel.PriceIzd = Math.Round(cena.Koeff.Value * cena.PriceMater.Value * Convert.ToDecimal(selectedVal), 2);
        //Service.InsertIzdelie(izdel);
        //var auState = await authenticationStateTask;
        //var User = auState.User;
        //var us = await userManager.GetUserAsync(User);
        //zakaz.IdClient = us.Id;
        //zakaz.DateZak = DateTime.Now;
        //zakaz.IdIzd = izdel.IdIzd;
        //zakaz.StatusZak = false;
        //zakazServ.InsertZakaz(zakaz);

        //TODO: Выбирать клиента
        clientSOAP = await localStorage.GetItemAsync<ClientSOAP>("login");
        createOrder.id_client = clientSOAP.id_client;
        createOrder.id_ref_prod = spr.id_ref_prod;
        createOrder.size = selectedVal;
        createOrder.weight = spr.weight_ref + selectedVal * 0.15;
        createOrder.price_prod = Convert.ToDouble(Math.Round((Configurator_page.select_mat.price_mater * createOrder.weight * 1.08), 2));

        if (soap.CreateOrder(createOrder)) ;

        var dialog = await DialogService.Show<Success>("Успешно").Result;
        if (!dialog.Cancelled)
        {
            NavMan.NavigateTo("/order");
        }
        else NavMan.NavigateTo("/");

    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Blazored.LocalStorage.ILocalStorageService localStorage { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private SOAPService soap { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavMan { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IDialogService DialogService { get; set; }
    }
}
#pragma warning restore 1591
